# üöÄ GU√çA DEFINITIVA - ADMIN-SKYPASS EN PRODUCCI√ìN
# M√©todo probado y funcional - Paso a paso

## üìã REQUISITOS DEL SERVIDOR
- Ubuntu 20.04 LTS o superior
- Acceso root o usuario con sudo
- Conexi√≥n a internet estable
- M√≠nimo: 2 CPU cores, 4GB RAM, 20GB disco

## üîß INSTALACI√ìN PASO A PASO

### PASO 1: ACTUALIZAR E INSTALAR DEPENDENCIAS DEL SISTEMA
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y build-essential python3 python3-pip python3-venv python3-dev postgresql postgresql-contrib redis-server git htop curl wget
```

### PASO 2: CONFIGURAR ZONA HORARIA (BOGOT√Å)
```bash
sudo timedatectl set-timezone America/Bogota
timedatectl  # Verificar
```

### PASO 3: CONFIGURAR POSTGRESQL
```bash
# Iniciar y habilitar PostgreSQL
sudo systemctl enable postgresql
sudo systemctl start postgresql

# Crear base de datos y usuario
sudo -u postgres psql -c "CREATE DATABASE admin_skypass;"
sudo -u postgres psql -c "CREATE USER skypass_user WITH PASSWORD 'skypass123';"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE admin_skypass TO skypass_user;"

# Verificar
sudo systemctl status postgresql
```

### PASO 4: CONFIGURAR REDIS
```bash
sudo systemctl enable redis-server
sudo systemctl start redis-server

# Verificar
sudo systemctl status redis-server
```

### PASO 5: CLONAR EL PROYECTO
```bash
cd /root
git clone https://github.com/josemestre3009/Admin-Skypass.git
cd /root/Admin-Skypass
```

### PASO 6: CREAR ENTORNO VIRTUAL E INSTALAR DEPENDENCIAS
```bash
# Crear entorno virtual
python3 -m venv venv

# Activar entorno virtual
source venv/bin/activate

# Instalar dependencias
pip install -r requirements.txt

# Verificar instalaci√≥n
pip list
```

### PASO 7: CONFIGURAR VARIABLES DE ENTORNO
```bash
nano .env
```

**Contenido del archivo .env:**
```env
# Configuraci√≥n de Admin Skypass
SECRET_KEY=tu-clave-secreta-muy-segura-aqui-cambiala

# Configuraci√≥n de base de datos (usa SQLite por defecto)
DATABASE_URL=sqlite:///isps.db

# Configuraci√≥n de email para alertas
GMAIL_USER=tu-email@gmail.com
GMAIL_PASSWORD=tu-app-password-de-16-caracteres

# Configuraci√≥n del servidor
HOST=0.0.0.0
PORT=5000
DEBUG=False

# Configuraci√≥n de monitoreo
MONITORING_INTERVAL=600
ALERT_COOLDOWN=86400
```

**Guardar:** `Ctrl+O`, `Enter`, `Ctrl+X`

### PASO 8: PROBAR QUE LA APP FUNCIONE
```bash
# Activar entorno virtual
cd /root/Admin-Skypass
source venv/bin/activate

# Probar que funcione
python app.py

# Si ves "Running on http://0.0.0.0:5000" ¬°todo bien!
# Det√©n con Ctrl+C
```

### PASO 9: PROBAR GUNICORN MANUALMENTE
```bash
# Probar Gunicorn manualmente
~/Admin-Skypass/venv/bin/gunicorn -w 4 -b 0.0.0.0:8000 app:app

# Si ves "Listening at: http://0.0.0.0:8000" ¬°todo bien!
# Det√©n con Ctrl+C
```

### PASO 10: CREAR EL SERVICIO SYSTEMD
```bash
sudo nano /etc/systemd/system/admin-skypass.service
```

**Contenido del servicio:**
```ini
[Unit]
Description=Admin-Skypass Web App
After=network.target postgresql.service redis.service

[Service]
User=root
WorkingDirectory=/root/Admin-Skypass
Environment="PATH=/root/Admin-Skypass/venv/bin"
ExecStart=/root/Admin-Skypass/venv/bin/gunicorn -w 4 -b 0.0.0.0:8000 app:app
Restart=always
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

**Guardar:** `Ctrl+O`, `Enter`, `Ctrl+X`

### PASO 11: HABILITAR Y ARRANCAR EL SERVICIO
```bash
# Recargar systemd
sudo systemctl daemon-reload

# Habilitar el servicio (arranque autom√°tico)
sudo systemctl enable admin-skypass

# Arrancar el servicio
sudo systemctl start admin-skypass

# Verificar que est√© funcionando
sudo systemctl status admin-skypass
```

### PASO 12: CONFIGURAR FIREWALL
```bash
# Permitir puerto 8000 (aplicaci√≥n)
sudo ufw allow 8000/tcp

# Permitir puerto 22 (SSH)
sudo ufw allow 22/tcp

# Habilitar firewall
sudo ufw --force enable

# Verificar reglas
sudo ufw status
```

### PASO 13: VERIFICAR INSTALACI√ìN
```bash
# Ver logs del servicio en tiempo real
sudo journalctl -u admin-skypass -f

# Verificar que est√© escuchando en el puerto 8000
sudo netstat -tlnp | grep 8000

# Obtener IP del servidor
hostname -I
```

## ‚úÖ ACCESO A LA APLICACI√ìN

1. **URL:** `http://TU_IP_SERVIDOR:8000`
2. **Usuario por defecto:** `admin`
3. **Contrase√±a por defecto:** `admin123`

## ‚öôÔ∏è CONFIGURACI√ìN POST-INSTALACI√ìN

### 1. Cambiar contrase√±a de admin
- Ir a: Configuraci√≥n ‚Üí Cambiar contrase√±a

### 2. Configurar email para alertas
- Ir a: Configuraci√≥n ‚Üí Email
- Configurar Gmail User y App Password
- Probar env√≠o de email

### 3. Agregar ISPs
- Ir a: Dashboard ‚Üí Agregar ISP
- Completar datos del ISP
- Probar conexi√≥n con GenieACS

## üîß COMANDOS √öTILES

### Reiniciar servicios
```bash
sudo systemctl restart admin-skypass
sudo systemctl restart postgresql
sudo systemctl restart redis-server
```

### Ver estado de servicios
```bash
sudo systemctl status admin-skypass
sudo systemctl status postgresql
sudo systemctl status redis-server
```

### Ver logs
```bash
# Logs de la aplicaci√≥n (tiempo real)
sudo journalctl -u admin-skypass -f

# Logs de la aplicaci√≥n (√∫ltimas 50 l√≠neas)
sudo journalctl -u admin-skypass -n 50

# Logs de PostgreSQL
sudo journalctl -u postgresql -f

# Logs de Redis
sudo journalctl -u redis-server -f
```

### Actualizar aplicaci√≥n desde GitHub
```bash
cd /root/Admin-Skypass
git pull origin main
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart admin-skypass
```

### Detener/Iniciar aplicaci√≥n
```bash
# Detener
sudo systemctl stop admin-skypass

# Iniciar
sudo systemctl start admin-skypass

# Reiniciar
sudo systemctl restart admin-skypass
```

## üÜò SOLUCI√ìN DE PROBLEMAS

### ‚ùå Si el servicio no arranca:
```bash
# Ver logs detallados
sudo journalctl -u admin-skypass --no-pager -n 100

# Probar manualmente para ver errores
cd /root/Admin-Skypass
source venv/bin/activate
python app.py
```

### ‚ùå Si hay error "ModuleNotFoundError":
```bash
cd /root/Admin-Skypass
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart admin-skypass
```

### ‚ùå Si hay problemas de permisos:
```bash
sudo chown -R root:root /root/Admin-Skypass
sudo chmod +x /root/Admin-Skypass/venv/bin/gunicorn
sudo systemctl restart admin-skypass
```

### ‚ùå Si hay problemas de base de datos:
```bash
# Verificar PostgreSQL
sudo systemctl status postgresql

# Probar conexi√≥n
sudo -u postgres psql -c "SELECT 1;"

# Ver bases de datos
sudo -u postgres psql -l
```

### ‚ùå Si no se puede acceder desde el navegador:
```bash
# Verificar que est√© escuchando
sudo netstat -tlnp | grep 8000

# Verificar firewall
sudo ufw status

# Verificar IP del servidor
hostname -I
```

## üì± CONFIGURACI√ìN DE EMAIL (GMAIL)

### Paso 1: Habilitar verificaci√≥n en 2 pasos
1. Ir a: https://myaccount.google.com/security
2. Activar "Verificaci√≥n en 2 pasos"

### Paso 2: Generar contrase√±a de aplicaci√≥n
1. Ir a: https://myaccount.google.com/apppasswords
2. Seleccionar "Correo" y "Otro (nombre personalizado)"
3. Escribir: "Admin Skypass"
4. Copiar la contrase√±a de 16 caracteres generada

### Paso 3: Configurar en la aplicaci√≥n
1. Acceder a: http://TU_IP:8000
2. Ir a: Configuraci√≥n
3. Pegar email y contrase√±a de aplicaci√≥n
4. Guardar y probar

## üéØ RESULTADO FINAL

- ‚úÖ **Aplicaci√≥n funcionando** en puerto 8000
- ‚úÖ **Servicio autom√°tico** al reiniciar el servidor
- ‚úÖ **Base de datos** SQLite configurada
- ‚úÖ **Redis** para tareas en background
- ‚úÖ **Firewall** configurado
- ‚úÖ **Zona horaria** Bogot√° configurada
- ‚úÖ **Monitoreo autom√°tico** de ISPs cada 10 minutos
- ‚úÖ **Alertas por email** funcionando

## üìä MONITOREO

### Ver uso de recursos
```bash
# Instalar htop si no est√°
sudo apt install htop -y

# Ver recursos
htop

# Ver uso de disco
df -h

# Ver uso de memoria
free -h
```

### Backup manual
```bash
# Backup de base de datos SQLite
cp /root/Admin-Skypass/instance/isps.db /root/backup_isps_$(date +%Y%m%d).db

# Backup de configuraci√≥n
cp /root/Admin-Skypass/.env /root/backup_env_$(date +%Y%m%d).env
```

---

## üöÄ ¬°INSTALACI√ìN COMPLETADA!

**Tu aplicaci√≥n Admin-Skypass est√° lista para producci√≥n.**

**Accede en:** `http://TU_IP_SERVIDOR:8000`

**Repositorio:** https://github.com/josemestre3009/Admin-Skypass

---

**Notas importantes:**
- Cambia la contrase√±a de admin despu√©s del primer login
- Configura el email para recibir alertas
- El monitoreo se ejecuta autom√°ticamente cada 10 minutos
- Los logs se guardan autom√°ticamente en systemd